<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Text Editor</title>
  <style>
    :root {
      color-scheme: light dark;
      font-family: "SF Mono", "Fira Code", "Menlo", "Consolas", monospace;
    }

    body {
      margin: 0;
      background: #0f1115;
      color: #f1f4f8;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 16px 20px;
      border-bottom: 1px solid #242b38;
      background: #161a22;
    }

    header h1 {
      margin: 0 0 6px;
      font-size: 18px;
      font-weight: 600;
    }

    header p {
      margin: 0;
      font-size: 13px;
      color: #9aa4b2;
      max-width: 760px;
      line-height: 1.5;
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 16px;
      padding: 20px;
      box-sizing: border-box;
    }

    .card {
      background: #131826;
      border: 1px solid #2d3445;
      border-radius: 14px;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .mode-toggle {
      display: inline-flex;
      background: #0b0d12;
      border: 1px solid #2d3445;
      border-radius: 999px;
      padding: 4px;
      gap: 4px;
      align-self: flex-start;
    }

    .mode-toggle button {
      appearance: none;
      border: 0;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 13px;
      font-weight: 600;
      background: transparent;
      color: #9aa4b2;
      cursor: pointer;
    }

    .mode-toggle button.is-active {
      background: #243049;
      color: #f5f7fb;
      box-shadow: 0 0 0 1px rgba(61, 108, 255, 0.4);
    }

    textarea {
      width: 100%;
      min-height: 180px;
      resize: vertical;
      padding: 16px;
      font-size: 15px;
      line-height: 1.6;
      border-radius: 12px;
      border: 1px solid #2d3445;
      background: #0b0d12;
      color: #f5f7fb;
      box-shadow: inset 0 0 0 1px transparent;
    }

    textarea:focus {
      outline: 2px solid #3d6cff;
      border-color: #3d6cff;
    }

    .display {
      min-height: 180px;
      padding: 16px;
      border-radius: 12px;
      border: 1px solid #2d3445;
      background: #0b0d12;
      color: #f5f7fb;
      white-space: pre-wrap;
      font-size: 15px;
      line-height: 1.6;
      position: relative;
    }

    .cursor {
      display: inline-block;
      width: 10px;
      height: 1.4em;
      background: #66d19e;
      vertical-align: text-bottom;
      box-shadow: 0 0 10px rgba(102, 209, 158, 0.6);
      border-radius: 2px;
    }

    .selection {
      background: rgba(61, 108, 255, 0.3);
      border-radius: 3px;
    }

    .status {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 8px 16px;
      font-size: 12px;
      color: #9aa4b2;
    }

    .controls {
      display: grid;
      gap: 12px;
    }

    .control-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    .control-row label {
      font-size: 12px;
      color: #9aa4b2;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    input[type="range"] {
      width: 220px;
    }

    .arrow-grid {
      display: grid;
      grid-template-columns: repeat(3, 44px);
      gap: 6px;
      justify-content: flex-start;
    }

    .arrow-grid button,
    .pill-button {
      appearance: none;
      border: 1px solid #2d3445;
      background: #1b2233;
      color: #f5f7fb;
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
    }

    .arrow-grid button:active,
    .pill-button:active {
      transform: translateY(1px);
    }

    .pill-button {
      min-width: 140px;
    }

    .helper {
      font-size: 12px;
      color: #9aa4b2;
    }

    @media (max-width: 600px) {
      main {
        padding: 16px;
      }

      input[type="range"] {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Text Editor</h1>
    <p>
      Type in Input mode to enter text. Switch to Cursor mode to move the cursor and
      set selection ranges without triggering the iOS on-screen keyboard.
    </p>
  </header>

  <main>
    <section class="card" aria-label="Mode selection">
      <div class="mode-toggle" role="tablist" aria-label="Editor mode">
        <button type="button" class="is-active" id="input-mode" role="tab" aria-selected="true">
          Input mode
        </button>
        <button type="button" id="cursor-mode" role="tab" aria-selected="false">
          Cursor mode
        </button>
      </div>
      <div class="helper" id="mode-helper">Input mode is active. Type to update the text.</div>
    </section>

    <section class="card" aria-label="Text editor">
      <label for="text-input" class="helper">Text input</label>
      <textarea id="text-input" placeholder="Start typing here..." spellcheck="false"></textarea>
      <div class="helper">Display preview</div>
      <div class="display" id="text-display" aria-live="polite"></div>
      <div class="status" id="status"></div>
    </section>

    <section class="card" aria-label="Cursor mode controls" id="cursor-controls" hidden>
      <div class="controls">
        <div class="control-row">
          <button type="button" class="pill-button" id="reset-selection">Collapse selection to cursor</button>
          <div class="helper">Use sliders to set exact positions without a keyboard.</div>
        </div>

        <div class="control-row">
          <label>
            Cursor position
            <input type="range" id="cursor-slider" min="0" value="0" step="1" />
            <span class="helper" id="cursor-value">0</span>
          </label>
          <label>
            Selection start
            <input type="range" id="selection-start" min="0" value="0" step="1" />
            <span class="helper" id="selection-start-value">0</span>
          </label>
          <label>
            Selection end
            <input type="range" id="selection-end" min="0" value="0" step="1" />
            <span class="helper" id="selection-end-value">0</span>
          </label>
        </div>

        <div class="control-row">
          <div class="arrow-grid" aria-label="Cursor movement">
            <span></span>
            <button type="button" data-move="up">▲</button>
            <span></span>
            <button type="button" data-move="left">◀</button>
            <button type="button" data-move="down">▼</button>
            <button type="button" data-move="right">▶</button>
          </div>
          <div class="helper">Move the cursor up, down, left, or right.</div>
        </div>
      </div>
    </section>
  </main>

  <script>
    const inputModeButton = document.getElementById("input-mode");
    const cursorModeButton = document.getElementById("cursor-mode");
    const modeHelper = document.getElementById("mode-helper");
    const textInput = document.getElementById("text-input");
    const textDisplay = document.getElementById("text-display");
    const status = document.getElementById("status");
    const cursorControls = document.getElementById("cursor-controls");
    const cursorSlider = document.getElementById("cursor-slider");
    const selectionStartSlider = document.getElementById("selection-start");
    const selectionEndSlider = document.getElementById("selection-end");
    const cursorValue = document.getElementById("cursor-value");
    const selectionStartValue = document.getElementById("selection-start-value");
    const selectionEndValue = document.getElementById("selection-end-value");
    const resetSelectionButton = document.getElementById("reset-selection");

    const state = {
      text: "",
      cursor: 0,
      selectionStart: 0,
      selectionEnd: 0,
      mode: "input"
    };

    const escapeHtml = (value) =>
      value
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/\"/g, "&quot;")
        .replace(/'/g, "&#39;");

    const updateSliders = () => {
      const max = state.text.length;
      [cursorSlider, selectionStartSlider, selectionEndSlider].forEach((slider) => {
        slider.max = String(max);
      });

      cursorSlider.value = String(state.cursor);
      selectionStartSlider.value = String(state.selectionStart);
      selectionEndSlider.value = String(state.selectionEnd);

      cursorValue.textContent = String(state.cursor);
      selectionStartValue.textContent = String(state.selectionStart);
      selectionEndValue.textContent = String(state.selectionEnd);
    };

    const updateStatus = () => {
      status.innerHTML = `
        <div>Characters: ${state.text.length}</div>
        <div>Cursor: ${state.cursor}</div>
        <div>Selection: ${Math.min(state.selectionStart, state.selectionEnd)}–${Math.max(state.selectionStart, state.selectionEnd)}</div>
      `;
    };

    const setCursor = (position) => {
      const clamped = Math.max(0, Math.min(state.text.length, position));
      state.cursor = clamped;
      state.selectionStart = clamped;
      state.selectionEnd = clamped;
      updateSliders();
    };

    const setSelectionRange = (start, end) => {
      const clampedStart = Math.max(0, Math.min(state.text.length, start));
      const clampedEnd = Math.max(0, Math.min(state.text.length, end));
      state.selectionStart = clampedStart;
      state.selectionEnd = clampedEnd;
      state.cursor = clampedEnd;
      updateSliders();
    };

    const getLineStart = (text, index) => text.lastIndexOf("\n", index - 1) + 1;

    const getLineEnd = (text, index) => {
      const nextBreak = text.indexOf("\n", index);
      return nextBreak === -1 ? text.length : nextBreak;
    };

    const getColumn = (text, index) => index - getLineStart(text, index);

    const moveCursorVertical = (direction) => {
      const text = state.text;
      const pos = state.cursor;
      const lineStart = getLineStart(text, pos);
      const column = getColumn(text, pos);
      const targetLineIndex = direction === "up"
        ? text.lastIndexOf("\n", lineStart - 2)
        : text.indexOf("\n", lineStart);

      if (direction === "up" && targetLineIndex === -1) {
        setCursor(0);
        return;
      }

      if (direction === "down" && targetLineIndex === -1) {
        setCursor(text.length);
        return;
      }

      const targetLineStart = direction === "up"
        ? text.lastIndexOf("\n", targetLineIndex - 1) + 1
        : targetLineIndex + 1;
      const targetLineEnd = getLineEnd(text, targetLineStart);
      const nextPos = Math.min(targetLineStart + column, targetLineEnd);
      setCursor(nextPos);
    };

    const moveCursorHorizontal = (direction) => {
      if (direction === "left") {
        setCursor(state.cursor - 1);
      }
      if (direction === "right") {
        setCursor(state.cursor + 1);
      }
    };

    const renderDisplay = () => {
      const start = Math.min(state.selectionStart, state.selectionEnd);
      const end = Math.max(state.selectionStart, state.selectionEnd);
      let output = "";

      for (let i = 0; i <= state.text.length; i += 1) {
        if (i === state.cursor) {
          output += '<span class="cursor" aria-hidden="true"></span>';
        }
        if (i === state.text.length) break;

        const char = state.text[i];
        const escaped = char === "\n" ? "\n" : escapeHtml(char);
        if (i >= start && i < end) {
          output += `<span class="selection">${escaped}</span>`;
        } else {
          output += escaped;
        }
      }

      textDisplay.innerHTML = output || '<span class="helper">(Text will appear here.)</span>';
    };

    const syncFromTextarea = () => {
      state.text = textInput.value;
      state.cursor = textInput.selectionEnd;
      state.selectionStart = textInput.selectionStart;
      state.selectionEnd = textInput.selectionEnd;
      updateSliders();
      updateStatus();
      renderDisplay();
    };

    const setMode = (mode) => {
      state.mode = mode;
      const isInput = mode === "input";
      inputModeButton.classList.toggle("is-active", isInput);
      cursorModeButton.classList.toggle("is-active", !isInput);
      inputModeButton.setAttribute("aria-selected", String(isInput));
      cursorModeButton.setAttribute("aria-selected", String(!isInput));
      cursorControls.hidden = isInput;
      textInput.readOnly = !isInput;
      modeHelper.textContent = isInput
        ? "Input mode is active. Type to update the text."
        : "Cursor mode is active. Use sliders and arrows to move without a keyboard.";

      if (isInput) {
        textInput.focus();
      } else {
        textInput.blur();
      }
    };

    inputModeButton.addEventListener("click", () => setMode("input"));
    cursorModeButton.addEventListener("click", () => setMode("cursor"));

    textInput.addEventListener("input", syncFromTextarea);
    textInput.addEventListener("select", syncFromTextarea);
    textInput.addEventListener("keyup", syncFromTextarea);

    cursorSlider.addEventListener("input", (event) => {
      setCursor(Number(event.target.value));
      updateStatus();
      renderDisplay();
    });

    selectionStartSlider.addEventListener("input", (event) => {
      setSelectionRange(Number(event.target.value), state.selectionEnd);
      updateStatus();
      renderDisplay();
    });

    selectionEndSlider.addEventListener("input", (event) => {
      setSelectionRange(state.selectionStart, Number(event.target.value));
      updateStatus();
      renderDisplay();
    });

    resetSelectionButton.addEventListener("click", () => {
      setCursor(state.cursor);
      updateStatus();
      renderDisplay();
    });

    document.querySelectorAll("[data-move]").forEach((button) => {
      button.addEventListener("click", (event) => {
        const direction = event.currentTarget.dataset.move;
        if (direction === "up" || direction === "down") {
          moveCursorVertical(direction);
        } else {
          moveCursorHorizontal(direction);
        }
        updateStatus();
        renderDisplay();
      });
    });

    syncFromTextarea();
    setMode("input");
  </script>
</body>
</html>
